{# Include reutilizável para o card/modal de confirmação de exclusão #}
{% comment %}
Expected context (optional):
- doc: objeto documento (opcional)
- tipo_objeto: string usada para montar urls (opcional)
- action_url: url absoluta ou relativa para o form de exclusão (opcional)
- cancel_url: url de cancelamento (opcional)
- objeto_nome: nome customizado do objeto (opcional, ex: "shopping", "documento")

If variables are not provided, the include renders placeholders with ids that can be updated via JS:
- #confirmDeleteMessage (texto principal)
- #confirmDocTitle (nome do documento)
- #confirmDocType (tipo do documento)
- #confirmDocInfo (container de info do documento)
{% endcomment %}

<div class="delete-confirmation-wrapper">
  <div class="delete-confirmation-card">
    
    <!-- Ícone de Alerta -->
    <div class="alert-icon-container">
      <div class="alert-icon-pulse">
        <svg class="alert-icon" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
          <line x1="12" y1="9" x2="12" y2="13"/>
          <line x1="12" y1="17" x2="12.01" y2="17"/>
        </svg>
      </div>
    </div>

    <div class="delete-card-content">
      
      <!-- Título -->
      <h2 class="delete-confirmation-title">Confirmar Exclusão</h2>
      
      <!-- Mensagem Principal -->
      <div class="delete-message-container">
        <p class="delete-message" id="confirmDeleteMessage">
          {% if doc %}
            Tem certeza que deseja excluir permanentemente
            {% if objeto_nome %}
              {{ objeto_nome|lower }}
            {% else %}
              o documento
            {% endif %}
            <strong class="highlight-text">{{ doc.titulo }}</strong>?
          {% else %}
            Tem certeza que deseja excluir este item permanentemente?
          {% endif %}
        </p>
      {# Clean, minimal confirmation include used by pages and modals #}
      {# Context (optional): action_url, cancel_url, doc, objeto_nome #}

      <div class="confirm-card" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
        <div class="confirm-card-inner">
          <header class="confirm-header">
            <h3 id="confirmTitle">Confirmar exclusão</h3>
            <button type="button" class="confirm-close" aria-label="Fechar" onclick="(function(){const b=document.getElementById('cancelDeleteBtn'); if(b) { if (b.href) window.location.href=b.href; else b.click(); } })()">×</button>
          </header>

          <div class="confirm-body">
            <p id="confirmDeleteMessage" class="confirm-message">
              {% if doc %}
                Tem certeza que deseja excluir <strong>{{ objeto_nome|default:"item" }} "{{ doc.titulo }}"</strong> permanentemente?
              {% else %}
                Tem certeza que deseja excluir este item permanentemente?
              {% endif %}
            </p>

            <div id="confirmDocInfo" class="confirm-info" {% if not doc %}style="display:none;"{% endif %}>
              {% if doc %}
              <div class="info-row"><strong>Nome:</strong> <span id="confirmDocTitle">{{ doc.titulo }}</span></div>
              {% if doc.get_tipo_display %}<div class="info-row"><strong>Tipo:</strong> <span id="confirmDocType">{{ doc.get_tipo_display|title }}</span></div>{% endif %}
              {% endif %}
            </div>
          </div>

          <footer class="confirm-footer">
            {% if action_url %}
              <form method="post" action="{{ action_url }}" id="deleteConfirmationForm" class="confirm-form">
                {% csrf_token %}
                <a href="{{ cancel_url|default:'#' }}" id="cancelDeleteBtn" class="btn-modern btn-cancel"> 
                  <!-- svg X -->
                  <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                  <span>Cancelar</span>
                </a>

                <button type="submit" id="confirmDeleteBtn" class="btn-delete" aria-label="Confirmar exclusão">
                  <!-- svg trash -->
                  <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
                  <span id="confirmDeleteBtnText">Confirmar</span>
                </button>
              </form>
            {% else %}
              <div class="confirm-actions">
                <button type="button" id="cancelDeleteBtn" class="btn-modern btn-cancel" data-bs-dismiss="modal"> 
                  <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                  <span>Cancelar</span>
                </button>

                <button type="button" id="confirmDeleteBtnInline" class="btn-delete" aria-label="Confirmar exclusão">
                  <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
                  <span id="confirmDeleteBtnTextInline">Confirmar</span>
                </button>
              </div>
            {% endif %}
          </footer>
        </div>
      </div>

      <style>
        /* Reset minimal and scoped styles for a clean confirmation UI */
        .confirm-card { max-width:620px; margin:0 auto; }
        .confirm-card-inner { background:#fff;border-radius:8px;border:1px solid #e6e6e9;box-shadow:0 6px 24px rgba(15,23,42,0.06);overflow:hidden;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
        .confirm-header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid #eef2f6}
        .confirm-header h3{margin:0;font-size:1rem;color:#111827}
        .confirm-close{background:transparent;border:0;font-size:20px;line-height:1;cursor:pointer;color:#6b7280}
        .confirm-body{padding:18px}
        .confirm-message{margin:0 0 12px;color:#374151}
        .confirm-info .info-row{font-size:0.94rem;color:#374151;margin:6px 0}
        .confirm-footer{display:flex;gap:10px;align-items:center;padding:12px 16px;border-top:1px solid #eef2f6;background:#fafafa;justify-content:flex-end}

  /* Buttons with high specificity to override Bootstrap and other styles */
  .confirm-card .btn-modern, .confirm-card button.btn-modern, .confirm-card a.btn-modern {
    display: inline-flex !important;
    align-items: center !important;
    gap: 8px !important;
    padding: 8px 12px !important;
    border-radius: 8px !important;
    background: transparent !important;
    border: 1px solid #d1d5db !important;
    color: #111827 !important;
    font-weight: 600 !important;
    text-decoration: none !important;
    cursor: pointer !important;
    box-shadow: none !important;
    transition: all 0.2s ease !important;
  }

  .confirm-card .btn-modern:hover, .confirm-card button.btn-modern:hover, .confirm-card a.btn-modern:hover {
    background: #f9fafb !important;
    border-color: #9ca3af !important;
    transform: translateY(-1px) !important;
    text-decoration: none !important;
  }

  .confirm-card .btn-modern svg, .confirm-card button.btn-modern svg, .confirm-card a.btn-modern svg {
    display: inline-block !important;
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
  }

  .confirm-card .btn-cancel, .confirm-card button.btn-cancel, .confirm-card a.btn-cancel {
    background: transparent !important;
    border: 1px solid #e5e7eb !important;
    color: #6b7280 !important;
  }

  .confirm-card .btn-cancel:hover, .confirm-card button.btn-cancel:hover, .confirm-card a.btn-cancel:hover {
    background: #f9fafb !important;
    border-color: #d1d5db !important;
    color: #374151 !important;
    text-decoration: none !important;
  }

  .confirm-card .btn-delete, .confirm-card button.btn-delete, .confirm-card a.btn-delete {
    display: inline-flex !important;
    align-items: center !important;
    gap: 8px !important;
    padding: 8px 14px !important;
    border-radius: 8px !important;
    background: linear-gradient(180deg, #dc2626, #b91c1c) !important;
    color: #fff !important;
    border: 0 !important;
    font-weight: 700 !important;
    cursor: pointer !important;
    box-shadow: none !important;
    text-decoration: none !important;
    transition: all 0.2s ease !important;
  }

  .confirm-card .btn-delete:hover, .confirm-card button.btn-delete:hover, .confirm-card a.btn-delete:hover {
    background: linear-gradient(180deg, #b91c1c, #991b1b) !important;
    transform: translateY(-1px) !important;
    box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3) !important;
    text-decoration: none !important;
    color: #fff !important;
  }        .btn-delete[disabled]{opacity:.7;cursor:not-allowed}

        /* Loading state */
        .btn-delete.loading{position:relative;color:transparent}
        .btn-delete.loading::after{content:"";position:absolute;right:12px;width:16px;height:16px;border:2px solid rgba(255,255,255,0.45);border-top-color:#fff;border-radius:50%;animation:spin .8s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}

        /* Ensure icons inside buttons don't get boxed */
        .confirm-card svg{background:transparent;box-shadow:none}

        @media (max-width:480px){.confirm-footer{flex-direction:column;align-items:stretch}.btn-delete,.btn-modern{width:100%}}
      </style>

      <script>
        (function(){
          'use strict';
          var form = document.getElementById('deleteConfirmationForm');
          var deleteBtn = document.getElementById('confirmDeleteBtn') || document.getElementById('confirmDeleteBtnInline');
          var cancelBtn = document.getElementById('cancelDeleteBtn');
          var btnText = document.getElementById('confirmDeleteBtnText') || document.getElementById('confirmDeleteBtnTextInline');
          var submitting = false;

          if (form && deleteBtn) {
            form.addEventListener('submit', function(e){
              if (submitting){ e.preventDefault(); return; }
              submitting = true;
              deleteBtn.disabled = true; deleteBtn.classList.add('loading'); if(btnText) btnText.textContent='Excluindo...';
              if (cancelBtn){ cancelBtn.style.pointerEvents='none'; cancelBtn.style.opacity='0.6'; }
            });
          }

          if (deleteBtn && !form){
            deleteBtn.addEventListener('click', function(e){
              if (submitting){ e.preventDefault(); return; }
              // If this is an inline/modal confirm, call default behavior (consumer may set onclick via updateDeleteConfirmation)
            });
          }

          document.addEventListener('keydown', function(e){ if(e.key==='Escape' && cancelBtn){ cancelBtn.click(); }});

          window.updateDeleteConfirmation = function(cfg){
            if (!cfg) return;
            var msg = document.getElementById('confirmDeleteMessage'); if (cfg.message && msg) msg.innerHTML = cfg.message;
            var title = document.getElementById('confirmDocTitle'); if (cfg.title && title) title.textContent = cfg.title;
            var type = document.getElementById('confirmDocType'); if (cfg.type && type) type.textContent = cfg.type;
            var info = document.getElementById('confirmDocInfo'); if (cfg.showInfo && info) info.style.display='block';
            if (cfg.onConfirm){ var b = document.getElementById('confirmDeleteBtn') || document.getElementById('confirmDeleteBtnInline'); if(b) b.onclick = cfg.onConfirm; }
          };
        })();
      </script>
      const messageEl = document.getElementById('confirmDeleteMessage');
      const titleEl = document.getElementById('confirmDocTitle');
      const typeEl = document.getElementById('confirmDocType');
      const infoEl = document.getElementById('confirmDocInfo');
      
      if (config.message && messageEl) {
        messageEl.innerHTML = config.message;
      }
      
      if (config.title && titleEl) {
        titleEl.textContent = config.title;
      }
      
      if (config.type && typeEl) {
        typeEl.textContent = config.type;
      }
      
      if (config.showInfo && infoEl) {
        infoEl.style.display = 'block';
      }
      
      if (config.onConfirm && deleteBtn) {
        deleteBtn.onclick = config.onConfirm;
      }
    };
    
  })();
</script>